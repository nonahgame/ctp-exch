<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Trading Bot</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        table { border-collapse: collapse; width: 100%; max-width: 800px; margin-bottom: 20px; }
        th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
        th { background-color: #f2f2f2; }
        .status-active { color: green; }
        .status-paused { color: orange; }
        .status-stopped { color: red; }
        h2 { margin-top: 20px; }
    </style>
</head>
<body>
    <h1>Trading Bot Status</h1>
    <table>
        <tr>
            <th>Parameter</th>
            <th>Value</th>
        </tr>
        <tr>
            <td>Bot Status</td>
            <td class="status-{{ bot_status }}">{{ bot_status | capitalize }}</td>
        </tr>
        <tr>
            <td>Timeframe</td>
            <td>{{ timeframe }}</td>
        </tr>
        <tr>
            <td>Total Trades</td>
            <td>{{ trades }}</td>
        </tr>
        <tr>
            <td>Current Time</td>
            <td>{{ current_time }}</td>
        </tr>
        <tr>
            <td>Latest Signal</td>
            <td>
                {% if signal_exists and signal %}
                Time: {{ signal.time }}<br>
                Action: {{ signal.action | capitalize }}<br>
                Price: {{ signal.price | float | round(4) }}<br>
                {% if signal.stop_loss is not none %}
                Stop-Loss: {{ signal.stop_loss | float | round(4) }}<br>
                {% endif %}
                {% if signal.take_profit is not none %}
                Take-Profit: {{ signal.take_profit | float | round(4) }}<br>
                {% endif %}
                Profit: {{ signal.profit | float | round(4) }}<br>
                Total Profit: {{ signal.total_profit | float | round(4) }}<br>
                Order ID: {{ signal.order_id or 'N/A' }}<br>
                Message: {{ signal.message }}
                {% else %}
                No signal data available
                {% endif %}
            </td>
        </tr>
        <tr>
            <td>Query Time</td>
            <td>{{ query_time | round(3) }} seconds</td>
        </tr>
    </table>

    <!-- Amendment 1: Add recent trades table -->
    <h2>Recent Trades</h2>
    {% if recent_trades %}
    <table>
        <tr>
            <th>Time</th>
            <th>Action</th>
            <th>Price</th>
            <th>Stop-Loss</th>
            <th>Take-Profit</th>
            <th>Profit</th>
            <th>Order ID</th>
            <th>Message</th>
        </tr>
        {% for trade in recent_trades %}
        <tr>
            <td>{{ trade.time }}</td>
            <td>{{ trade.action | capitalize }}</td>
            <td>{{ trade.price | float | round(4) }}</td>
            <td>{{ trade.stop_loss | float | round(4) if trade.stop_loss is not none else 'N/A' }}</td>
            <td>{{ trade.take_profit | float | round(4) if trade.take_profit is not none else 'N/A' }}</td>
            <td>{{ trade.profit | float | round(4) }}</td>
            <td>{{ trade.order_id or 'N/A' }}</td>
            <td>{{ trade.message }}</td>
        </tr>
        {% endfor %}
    </table>
    {% else %}
    <p>No recent trades available.</p>
    {% endif %}

    <!-- Amendment 2: Auto-refresh page every timeframe interval -->
    <script>
        setTimeout(function() {
            window.location.reload();
        }, {{ timeframe_seconds * 1000 }});
    </script>
</body>
</html>
